/***************************************************************************************************
Notes: 
***************************************************************************************************/
#include "address_map.h"

/***************************************************************************************************
Global Variables:
***************************************************************************************************/
double PWMLength = 0;
double percentage = 0.0;

/***************************************************************************************************
Function Definitions:
***************************************************************************************************/

void SetPWM(unsigned int period, double percent)
{
    volatile int* HPSTimer1Ptr = (int*) HPS_TIMER1_BASE;
    period = period * 100;
    double math = period * percent;

    /************************************************
    HPS Timer:
    ************************************************/
    *(HPSTimer1Ptr + 2) &= ~(1 << 0); // E = 0
    *(HPSTimer1Ptr) = (int)math; // load value
    *(HPSTimer1Ptr + 2) |= (1 << 1); // M = 1
    *(HPSTimer1Ptr + 2) |= (1 << 0); // E = 1
}

void PWM_Setup(void)
{
    volatile int* GPIOPtr = (int*)JP1_BASE;
    *(GPIOPtr + 1) |= (1 << 1); // D1 output
}